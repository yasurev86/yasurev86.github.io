<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Markerless AR Red Sphere</title>
	<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
	<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
	<style>
		body {
			margin: 0;
			padding: 0;
			overflow: hidden;
		}
		.arjs-loader {
			height: 100%;
			width: 100%;
			position: absolute;
			top: 0;
			left: 0;
			background-color: rgba(0, 0, 0, 0.8);
			z-index: 9999;
			display: flex;
			justify-content: center;
			align-items: center;
			color: white;
		}
		#placement-info {
			position: absolute;
			bottom: 20px;
			left: 0;
			right: 0;
			text-align: center;
			color: white;
			background-color: rgba(0, 0, 0, 0.5);
			padding: 10px;
			z-index: 1000;
		}
		#place-button {
			position: absolute;
			bottom: 80px;
			left: 50%;
			transform: translateX(-50%);
			padding: 10px 20px;
			background-color: #4CAF50;
			color: white;
			border: none;
			border-radius: 5px;
			font-size: 16px;
			z-index: 1000;
		}
	</style>
</head>
<body>
<!-- Loading message -->
<div class="arjs-loader">
	<div>Loading AR experience...</div>
</div>

<!-- Placement instructions -->
<div id="placement-info">
	Move your device to detect surfaces, then tap the button to place the sphere
</div>

<!-- Placement button -->
<button id="place-button" style="display: none;">Place Red Sphere</button>

<!-- AR Scene -->
<a-scene
	vr-mode-ui="enabled: false"
	embedded
	arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;"
	renderer="logarithmicDepthBuffer: true;"
	gesture-detector
>
	<!-- Red sphere that will be placed -->
	<a-entity id="sphere-entity" visible="false">
		<a-sphere
			position="0 0 0"
			radius="0.2"
			color="red"
			material="shader: standard; metalness: 0.3; roughness: 0.4"
		></a-sphere>
	</a-entity>

	<!-- Camera -->
	<a-entity camera></a-entity>
</a-scene>

<script>
  // Hide loader once scene is loaded
  const scene = document.querySelector('a-scene');
  const placeButton = document.getElementById('place-button');
  const placementInfo = document.getElementById('placement-info');
  const sphereEntity = document.getElementById('sphere-entity');

  let spherePlaced = false;

  scene.addEventListener('loaded', function() {
    document.querySelector('.arjs-loader').style.display = 'none';
    placeButton.style.display = 'block';

    // Add click/tap event for placing the sphere
    placeButton.addEventListener('click', placeSphere);
    scene.addEventListener('click', placeSphere);
  });

  function placeSphere() {
    if (spherePlaced) return;

    // Get camera position and direction
    const camera = document.querySelector('[camera]');
    const cameraPos = camera.getAttribute('position');
    const cameraRotation = camera.getAttribute('rotation');

    // Calculate position 1 meter in front of camera
    const distance = 1;
    const theta = THREE.MathUtils.degToRad(cameraRotation.y);
    const x = cameraPos.x - Math.sin(theta) * distance;
    const z = cameraPos.z - Math.cos(theta) * distance;
    const y = cameraPos.y;

    // Position the sphere
    sphereEntity.setAttribute('position', {x, y, z});
    sphereEntity.setAttribute('visible', 'true');

    // Update UI
    spherePlaced = true;
    placeButton.style.display = 'none';
    placementInfo.textContent = "Sphere placed! Move around to view it from different angles";

    // Make it stay in world space
    sphereEntity.setAttribute('static-body', '');
  }
</script>
</body>
</html>
